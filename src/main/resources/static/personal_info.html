<!DOCTYPE html>
<html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>个人信息</title>

    <script src="js/src.js"></script>
    <script src="js/util.js"></script>

    <script src="js/jquery.cropit.js"></script>

</head>
<body>
<script src="js/header.js"></script>
<div class="container-fluid">
    <div row>
        <div class="col-sm-6 col-md-6 col-lg-6 col-sm-offset-3 col-md-offset-3 col-lg-offset-3">
            <div class="panel panel-default">

                <div class="panel-body">
                    <div class="list-group-item">
                        <h2 style="text-align: center"> 个人信息</h2>
                        <div id="modifyUserInfo">
                            <div class="form-group">
                                <label>头像：</label>
                                <br>
                                <a style="cursor: pointer" data-toggle="modal" data-target="#myModal" id="show-photo">
                                        <img src="img/display-photo.jpg" class="img-circle img-lg">
                                </a>
                            </div>
                            <div class="form-group">
                                <label>用户名：</label>
                                 <input type="text" id="name" v-model="userName" class="form-control" readonly/>
                                <span class="spa-name"></span>
                            </div>
                            <div class="form-group">
                                <label>密码：</label>
                                <input type="password" id="pwd" v-model="userPassword" class="form-control"/>
                                <span class="spa spa-pwd"></span>
                            </div>
                            <div class="form-group">
                                <label>新密码：</label>
                                <input type="password" id="new-pwd" v-model="userNewPassword" class="form-control"/>
                                <span class="spa spa-new-pwd"></span>
                            </div>
                            <div class="form-group">
                                <label>确认密码：</label>
                                <input type="password" id="check-pwd" v-model="userConfirmPassword" class="form-control"/>
                                <span class="spa spa-check-pwd"></span>
                            </div>
                            <div class="form-group">
                                <label>生日：</label>
                                <input type="date" id="birthday" v-model="userBirthday" class="form-control"/>
                                <span class="spa spa-birthday"></span>
                            </div>
                            <div class="form-group">
                                <label>性别：</label>
                                <label class="radio-inline">
                                    <input type="radio" name="sex" id="inlineRadio1" value="男" v-model="userSex"> 男
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="sex" id="inlineRadio2" value="女" v-model="userSex"> 女
                                </label>
                                <span class="spa spa-sex"></span>
                            </div>
                            <div class="form-group">
                                <label>职业：</label>
                                <input type="text" id="job" v-model="userJob" class="form-control"/>
                                <span class="spa spa-job"></span>
                            </div>
                            <div class="form-group">
                                <label>邮箱：</label>
                                <input type="text" id="email" v-model="userEmail" class="form-control"/>
                                <span class="spa spa-email"></span>
                            </div>
                            <div class="form-group">
                                <label>手机号：</label>
                                <input type="text" id="phone" v-model="userPhoneNumber" class="form-control"/>
                                <span class="spa spa-phone"></span>
                            </div>
                            <div class="form-group">
                                <label>联系地址:</label>
                                <input type="text" id="address" v-model="userAddress" class="form-control"/>
                                <span class="spa spa-address"></span>
                            </div>
                            <div class="form-group">
                                <label>兴趣爱好：</label>
                                <input type="text" id="interest" v-model="userFavorite" class="form-control"/>
                                <span class="spa spa-interest"></span>
                            </div>
                            <div class="form-group">
                                <label>个性签名：</label>
                                <textarea class="form-control" rows="3" v-model="userSignature"></textarea>
                                <span class="spa spa-remark"></span>
                            </div>
                            <div class="form-group" style="float: right">
                                <button type="button" class="btn btn-primary" v-on:click="updateInfo">保存</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">更改头像</h4>
            </div>
            <div class="image-editor">
                <div class="modal-body">
                    <input type="file" class="cropit-image-input ">
                    <div class="cropit-preview"></div>
                    <div class="image-size-label">
                        比例
                    </div>
                    <input type="range" class="cropit-image-zoom-input">
                    <button class="rotate-ccw btn btn-default ">逆时针旋转</button>
                    <button class="rotate-cw btn btn-default  ">瞬时针旋转</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button class=" btn btn-success export" data-dismiss="modal">保存</button>
                </div>
            </div></div>
        </div>
    </div>
</div>
<script>
    $(function () {
        $('.image-editor').cropit({
            imageState: {
                src: 'http://lorempixel.com/500/400/',
            },
        });

        $('.rotate-cw').click(function () {
            $('.image-editor').cropit('rotateCW');
        });
        $('.rotate-ccw').click(function () {
            $('.image-editor').cropit('rotateCCW');
        });

        $('.export').click(function () {
            var imageData = $('.image-editor').cropit('export');
            // window.open(imageData);
            var show = document.getElementById("show-photo");
            show.innerHTML = '<img src=\"' + imageData + '\" class=\"img-circle img-lg\" >';
        });
    });
    /************************  失焦判断  **********************************/
//    $("input").blur(function () {
//        $(".spa").css("color", "#BD362F")
//        if ($(this).is("#email")) {             //邮箱判断
//            var na = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/
//            if ($("#email").val() != "") {
//                if (!(na.test($("#email").val()))) {
//                    $(".spa-email").text("请填写正确的邮箱");
//                    return false;
//                } else if (na) {
//                    $(".spa-email").text("");
//                    return true;
//                }
//            } else {
//                $(".spa-email").text("");
//            }
//        }
//        if ($(this).is("#pwd")) {               //密码判断
//            var ad = /^[a-zA-Z]\w{5,17}$/;
//            if ($("#pwd").val() != "") {
//                if (!(ad.test($("#pwd").val()))) {
//                    $(".spa-pwd").text("密码以字母开头，长度在6~18之间，只能包含字符、数字和下划线");
//                    return false;
//                } else if (ad) {
//                    $(".spa-pwd").text("");
//                    return true;
//                }
//            } else {
//                $(".spa-pwd").text("");
//            }
//        }
//        if ($(this).is("#check-pwd")) {            //确认密码判断
//            if ($("#check-pwd").val() != "") {
//                if ($("#pwd").val() != $("#check-pwd").val()) {
//                    $(".spa-check-pwd").text("两次输入的密码不同");
//                    return false;
//                } else {
//                    $(".spa-check-pwd").text("");
//                    return true;
//                }
//            } else {
//                $(".spa-check-pwd").text("");
//            }
//        }
//        if ($(this).is("#phone")) {            //手机号判断
//            var ph = /^1(3|4|5|7|8)\d{9}$/;
//            if ($("#phone").val() != "") {
//                if (!(ph.test($("#phone").val()))) {
//                    $(".spa-phone").text("请输入正确的手机号");
//                    return false;
//                } else if (ph) {
//                    $(".spa-phone").text("");
//                    return true;
//                }
//            } else {
//                $(".spa-phone").text("");
//            }
//        }
//    })
//
//    /*********************** 提交验证 ***************************/
//    $("#register").click(function () {
//        var em = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;   //邮箱正则
//        var pw = /^[a-zA-Z]\w{5,17}$/;     //密码正则
//        var ph=/^1(3|4|5|7|8)\d{9}$/; 手机号正则
//        if (em.test($("#email").val()) && $("#pwd").val() == $("#check-pwd").val() && pw.test($("#pwd").val())
//            && ph.test($("#phone").val())) {
//            return true;
//        } else {
//            if ($("#name").val() == "") {
//                $(".spa-name").text('请填写用户名')
//            }
//            if ($("#pwd").val() == "") {
//                $(".spa-pwd").text('请填写密码')
//            }
//            if ($("#check-pwd").val() == "") {
//                $(".spa-check-pwd").text('请再次填写密码')
//            }
//            return false;
//        }
//    })

    var modifyUserInfo = new Vue({
        el:"#modifyUserInfo",
        data:{
            userName:'',
            userPassword:'',
            userNewPassword:'',
            userConfirmPassword:'',
            userBirthday:'1996-10-01',
            userSex:'男',
            userJob:'学生',
            userEmail:'example@example.com',
            userAddress:'上海市宝山区上海大学校内',
            userPhoneNumber:'13120537282',
            userFavorite: '编程',
            userSignature:'我爱学习，学习爱我'
        },
        created:function () {
            this.initUserInfo();
        },
        methods:{
            initUserInfo:function () {
                var user = {};
                var userDetail = "";
                user.userId = url.getCookie("userId");
                $.ajax({
                    async : false,
                    type : 'POST',
                    url : 'http://localhost:8080/GRCBlog/getUser',
                    data : user,
                    dataType : 'json',
                    success : function(result) {
                        user = result.user;
                        userDetail = result.userDetail;
                    },
                    error : function(result) {
                        layer.msg('服务器异常');
                    }
                });

                this.userName = user.userName;
                this.userBirthday = userDetail.birthday;
                this.userSex = userDetail.sex;
                this.userJob= userDetail.job;
                this.userEmail = user.email;
                this.userAddress = userDetail.address;
                this.userPhoneNumber = userDetail.phone;
                this.userFavorite = userDetail.interest;
                this.userSignature = userDetail.remark;
            },
            updateInfo:function () {
                var user = {};
                var updateResult = "";
                user.userId = url.getCookie("userId");
                user.userName = this.userName;
                user.userPassword = this.userPassword;
                user.email = this.userEmail;
                user.sex = this.userSex;
                user.phone = this.userPhoneNumber;
                user.address = this.userAddress;
                user.interest = this.userFavorite;
                user.birthday = this.userBirthday;
                user.remark = this.userSignature;
                user.job = this.userJob;
                $.ajax({
                    async : false,
                    type : 'POST',
                    url : 'http://localhost:8080/GRCBlog/updateUser',
                    data : user,
                    dataType : 'json',
                    success : function(result) {
                        updateResult = result.updateResult;
                    },
                    error : function(result) {
                        layer.msg('服务器异常');
                    }
                });
                if(updateResult == "success")
                    layer.msg("更新用户信息成功",{icon:1});
                else
                    layer.msg("更新用户信息失败",{icon:2});
            }
        }
    })
</script>
</body>
</html>