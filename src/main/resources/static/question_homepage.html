<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>问答页</title>
    <script src="js/src.js"></script>
    <script src="js/util.js"></script>



</head>
<body>


<div class="container">
    <div row>
        <div class="col-sm-10 col-md-10 col-lg-10 col-sm-offset-1 col-md-offset-1 col-lg-offset-1">
            <div class="form-inline">
                <input type="text" class="form-control " placeholder="搜索" style="width: 80%">
                <button type="submit" class="btn btn-default no-border">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                </button>
                <a href="http://localhost:8080/GRCBlog/write_question.html"><button class="btn btn-primary" >我要提问</button></a>
            </div>
        </div>
    </div>
    <div row>
        <div class="col-sm-10 col-md-10 col-lg-10 col-sm-offset-1 col-md-offset-1 col-lg-offset-1">
            <div class="panel panel-default">
                <div class="panel-body">
                    <ul class="nav nav-tabs" role="tablist" id="feature-tab">
                        <li class="active">
                            <a href="#tab-hot" role="tab" data-toggle="tab">
                                <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> 精华</a>
                        </li>
                        <li><a href="#tab-unsolve" role="tab" data-toggle="tab">
                            <span class="glyphicon glyphicon-file" aria-hidden="true"></span> 等待回答</a></li>
                        <li><a href="#tab-recent" role="tab" data-toggle="tab">
                            <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span> 动态</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab-hot">
                            <div class="list-group" id="better">
                                <question-item v-for="item in question" v-bind:question="item"></question-item>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab-unsolve">
                            <div class="list-group " id="unsolve">
                                <question-item v-for="item in unsolve_question" v-bind:question="item"></question-item>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab-recent">
                            <div class="list-group ">
                                <div class="list-group-item">
                                    <div class="pull-right">
                                        <span class="label label-info">java</span>
                                        <span class="label label-info">计划书</span>
                                    </div>
                                    <h3>怎么写java开发计划书？</h3>
                                    <p>
                                        如题，给个思路
                                    </p>
                                    <span class="text-muted">悬赏积分：</span>3&nbsp&nbsp&nbsp
                                    <span class="text-muted">状态：</span>未解决&nbsp&nbsp&nbsp
                                    <span class="text-muted">回答数：</span>123&nbsp&nbsp&nbsp
                                    <span class="text-muted">发表时间：</span>7小时前&nbsp&nbsp&nbsp
                                    <span class="text-muted">提问者：</span>小民&nbsp&nbsp&nbsp
                                </div>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script type="text/javascript">

    Vue.component('question-item',{
        props: ['question'],
        template:'<div class="list-group-item">'+
                    //onClick中的函数需要修改，等端口写好之后，修改，根据id获取问题
                 //'<div class="pull-right" >'+
                ' <h3>{{ question.title }}</h3>'+
                '<p>{{ question.questionContent }}</p>'+
                ' <span class="text-muted">悬赏积分：{{ question.score }}</span> &nbsp&nbsp&nbsp'+
                ' <span class="text-muted">状态：{{ question.state }}</span>&nbsp&nbsp&nbsp'+
                '<span class="text-muted">回答数：{{ question.answerNum }}</span> &nbsp&nbsp&nbsp'+
                ' <span class="text-muted">发表时间：{{ question.publish_time }}</span> &nbsp&nbsp&nbsp'+
                '<span class="text-muted">提问者：{{ question.anthor }}</span> &nbsp&nbsp&nbsp'+
                '<hr>'+
                '</div>'

    })


    var question = new Vue({
        el: "#better",
        data:{
            question:questionContent()
        }
    })

    var unsolve_question = new Vue({
        el: "#unsolve",
        data:{
            unsolve_question:unsolve_questionContent()
        }
    })

    function questionContent() {
        var questionData = getAllQuestions(1);
//        layer.msg(blogData.userId);

        for(var i = 0; i<questionData.length;i++) {
            var user = getUser(questionData[i].userId);
            var Date = formatDate(questionData[i].publishTime);
            questionData[i].publish_time = Date;
            questionData[i].anthor = user.userName;
        }
       return questionData;

    }


    function unsolve_questionContent()
    {
        var unsolve = getAllQuestions(1);
        //满足要求的放入temp
        var temp=[{}];
        for(var i=0;i<unsolve.length;i++)
        {
            if(unsolve[i].state!=0)
            {
                var user = getUser(unsolve[i].userId);
                var Date = formatDate(unsolve[i].publishTime);
                unsolve[i].publish_time = Date;
                unsolve[i].anthor = user.userName;
                temp[i]=unsolve[i];
            }

        }
        return  temp;
    }

    function getAllQuestions(id) {
        var question = null;
        var nothing = {};
        if(id==null)
        {
            nothing.userId=1;
        }
        else
            nothing.userId=id;
        $.ajax({
            async : false, //设置同步
            type : 'POST',
            url : 'http://localhost:8080/GRCBlog/getAllQuestions',
            data : nothing,
            dataType : 'json',
            success : function(result) {
                if (result!=null) {
                    question = result.questions;
                }
                else{
                   alert('查询错误!!');
                }
            },
            error : function(resoult) {
                alert('服务器异常');
            }
        });
        //划重点划重点，这里的eval方法不同于prase方法，外面加括号
        question = eval("("+question+")");
        return question;
    }


    function getUser(id) {
        var user = null;
        var users = {};
        users.userId = 1;

        $.ajax({
            async : false, //设置同步
            type : 'POST',
            url : 'http://localhost:8080/GRCBlog/getUser',
            data :users,
            dataType : 'json',
            success : function(result) {
                if (result!=null) {
                    user = result.user;

                }
                else{
                    alert('查询错误~~');
                }
            },
            error : function(result) {
                alert('服务器查询错误!!');
            }
        });
        //划重点划重点，这里的eval方法不同于prase方法，外面加括号

        alert(user);
        return user;
    }


    function   formatDate(time)   {
        var date = new Date(time);
        Y = date.getFullYear() + '-';
        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
        D = date.getDate() + ' ';
        h = date.getHours() + ':';
        m = date.getMinutes() + ':';
        s = date.getSeconds();

        return Y+M+D+h+m+s;
    }

</script>


</body>
</html>