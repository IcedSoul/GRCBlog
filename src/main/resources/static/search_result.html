<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>搜索结果</title>
    <script src="js/src.js"></script>
    <script src="js/util.js"></script>



</head>
<body>


<div class="container">
    <div row>
        <div class="col-sm-10 col-md-10 col-lg-10 col-sm-offset-1 col-md-offset-1 col-lg-offset-1">
            <div class="form-inline">
                <input type="text" class="form-control " placeholder="搜索" style="width: 80%">
                <button type="submit" class="btn btn-default no-border">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                </button>
                <a href="http://localhost:8080/GRCBlog/write_question.html"><button class="btn btn-primary ">我要提问</button></a>
            </div>
        </div>
    </div>
    <div row>
        <div class="col-sm-10 col-md-10 col-lg-10 col-sm-offset-1 col-md-offset-1 col-lg-offset-1">
            <div class="panel panel-default">
                <div class="panel-body">
                    <ul class="nav nav-tabs" role="tablist" id="feature-tab">
                        <li class="active">
                            <a href="#tab-article" role="tab" data-toggle="tab">
                                <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> 博文</a>
                        </li>
                        <li ><a href="#tab-resource" role="tab" data-toggle="tab">
                            <span class="glyphicon glyphicon-file" aria-hidden="true"></span> 资源</a></li>
                        <li ><a href="#tab-recent" role="tab" data-toggle="tab">
                            <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span> 问答</a>
                        </li>
                        <li ><a href="#tab-user" role="tab" data-toggle="tab">
                            <span class="glyphicon glyphicon-user" aria-hidden="true"></span> 用户</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab-article">
                            <div class="list-group ">
                                <div class="list-group-item">
                                    <div style="text-align: right">
                                        <button type="button" class="btn btn-default no-border" >按时间排序</button>
                                        <button type="button" class="btn btn-default no-border" >按热门排序</button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group " id="blog">

                                <blog-item v-for="item in blog" v-bind:blog="item"></blog-item>

                            </div>
                        </div>
                        <div class="tab-pane" id="tab-resource">
                            <div class="list-group">
                                <div class="list-group-item">
                                    <div style="text-align: right">
                                        <button type="button" class="btn btn-default no-border">按时间排序</button>
                                        <button type="button" class="btn btn-default no-border">按热门排序</button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group" id="upload">
                                <upload-item v-for="item in upload" v-bind:upload="item"></upload-item>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab-recent">
                            <div class="list-group">
                                <div class="list-group-item">
                                    <div style="text-align: right">
                                        <button type="button" class="btn btn-default no-border">按时间排序</button>
                                        <button type="button" class="btn btn-default no-border">按热门排序</button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group "id="question">
                                <question-item v-for="item in question" v-bind:question="item"></question-item>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab-user">
                            <div class="list-group default">
                                <div class="list-group-item">
                                    <div class="media">
                                        <div class="media-left media-middle">
                                            <img src="img/display-photo.jpg" class="img-circle img-md">

                                        </div>
                                        <div class="media-body">
                                            <h4 style="font-weight: bold">小民同学</h4>
                                            <p><span class="text-muted">性别：</span>女&nbsp&nbsp&nbsp
                                                <span class="text-muted">职业：</span>java工程师&nbsp&nbsp&nbsp
                                                <span class="text-muted">兴趣：</span>编程&nbsp&nbsp&nbsp</p>
                                            <p><span class="text-muted">个性签名：</span>我爱编程&nbsp&nbsp&nbsp</p>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    //var imgURL = "http://localhost:8080/GRCBlog/img/" + user.img + ".jpg";

    //博客页
    Vue.component('blog-item', {
        props: ['blog'],
        template: '<div class="list-group-item">' +
                '<div class="pull-right">' +
                ' <span class="label label-info">{{blog.tags}}java</span>' +
                '</div>' +
                '<a class="" href="imgURL"><img src="img/display-photo.jpg"class="img-circle img-md"></a>' +
                '<span>{{ blog.anthor}}</span>' +
                '<h3>{{ blog.title }}</h3>' +
                '<p>{{ blog.blogContent }}</p>' +
                '<span class="text-muted">评论数：</span>{{ blog.leaveNum }}&nbsp&nbsp&nbsp' +
                '<span class="text-muted">发表时间：</span>{{blog.publishTime }}&nbsp&nbsp&nbsp ' +
                '</div>' +
                '<hr>'
    })

    var blog = new Vue({
        el: "#blog",
        data:{
            blog:blogContent()
        }
    })

    function blogContent() {
        var blogData = getAllBlogs(1);
//        layer.msg(blogData.userId);

        for(var i = 0; i< blogData.length; i++) {
            var user = getUser(blogData[i].userId);

            var Date = formatDate(blogData[i].publishTime);
            blogData[i].publishTime = Date;
            blogData[i].anthor = user.userName;
        }
        return blogData;

    }

        //资源页
        Vue.component('upload-item', {
            props: ['upload'],
            template: '<div class="list-group-item">' +
            '<div class="pull-right">' +
            ' <span class="label label-info">{{tags}}</span>' +
            '</div>' +
            '<div class="media">' +
            '<div class="media-left">' +
            '<svg width="64" height="64" version="1.1" xmlns="http://www.w3.org/2000/svg">' +
            '<rect width="50" height="60" style="fill:gray;"/>' +
            '<polygon style="fill:#FFFFFF;" points="35,0 50,0 50,15 "/>' +
            '<polygon style="fill:#FFFFFF;" points="30,3 45,20 30,20 "/>' +
            '<text x="5" y="40" font-size="15" style="fill:white">RAR</text>' +
            '</svg>' +
            '</div>' +
            '<div class="media-body">' +
            '<h4 style="">{{ upload.name }}</h4>' +
            '<p>{{ upload.remark }}</p>' +
            '<br>' +
            '<span class="text-muted">所需积分：{{ upload.score }} </span>分&nbsp&nbsp&nbsp' +
            '<span class="text-muted">下载次数：{{upload.downNum }}</span> 次&nbsp&nbsp&nbsp' +
            '<span class="text-muted">上传时间：{{ upload.publish_time }}</span>&nbsp&nbsp&nbsp' +
            '<span class="text-muted">上传者：{{upload.anthor}}</span>'+
            '</div>' +
            '</div>' +
            '</div>' +
            '<hr>'
        })


        var upload = new Vue({
            el: "#upload",
            data:{
                upload:uploadContent()
            }
        })

        function uploadContent() {
            var uploadData = getAllUpload();
//        layer.msg(blogData.userId);

            for(var i = 0; i<uploadData.length;i++) {
                var user = getUser(uploadData[i].userId);
                var Date = formatDate(uploadData[i].upTime);
                uploadData[i].publish_time = Date;
                uploadData[i].anthor = user.userName;
            }
            return uploadData;

        }


        //问答页
        Vue.component('question-item',{
            props: ['question'],
            template:'<div class="list-group-item">'+
            //onClick中的函数需要修改，等端口写好之后，修改，根据id获取问题
            //'<div class="pull-right" >'+
            ' <h3>{{ question.title }}</h3>'+
            '<p>{{ question.questionContent }}</p>'+
            ' <span class="text-muted">悬赏积分：{{ question.score }}</span> &nbsp&nbsp&nbsp'+
            ' <span class="text-muted">状态：{{ question.state }}</span>&nbsp&nbsp&nbsp'+
            '<span class="text-muted">回答数：{{ question.answerNum }}</span> &nbsp&nbsp&nbsp'+
            ' <span class="text-muted">发表时间：{{ question.publish_time }}</span> &nbsp&nbsp&nbsp'+
            '<span class="text-muted">提问者：{{ question.anthor }}</span> &nbsp&nbsp&nbsp'+
            '<hr>'+
            '</div>'
        })

        var question = new Vue({
            el: "#question",
            data:{
                question:questionContent()
            }
        })

        function questionContent() {
            var questionData = getAllQuestions(1);
//        layer.msg(blogData.userId);

            for(var i = 0; i < questionData.length;i++) {
                var user = getUser(questionData[i].userId);
                var Date = formatDate(questionData[i].publishTime);
                questionData[i].publish_time = Date;
                questionData[i].anthor = user.userName;
            }
            return questionData;
        }


        function getAllQuestions(id) {
            var questions = null;
            var nothing = {};
            if(id==null)
            {
                nothing.userId=1;
            }
            else
                nothing.userId=id;
            $.ajax({
                async: false, //设置同步
                type: 'POST',
                url: 'http://localhost:8080/GRCBlog/getAllQuestions',
                data: nothing,
                dataType: 'json',
                success: function (result) {
                    if (result != null) {
                        questions = result.questions;

                    }
                    else {
                        alert('查询错误!!');
                    }
                },
                error: function (resoult) {
                    alert('服务器异常');
                }
            });
            //划重点划重点，这里的eval方法不同于prase方法，外面加括号
            questions = eval("(" + questions + ")");
            return questions;
        }


        function getUser(id) {
            var user = null;
            var users = {};
            users.userId = id;

            $.ajax({
                async: false, //设置同步
                type: 'POST',
                url: 'http://localhost:8080/GRCBlog/getUser',
                data: users,
                dataType: 'json',
                success: function (result) {
                    if (result != null) {
                        user = result.user;
                    }
                    else {
                        alert('查询错误');
                    }
                },
                error: function (result) {
                    alert('查询错误!!');
                }
            });
            //划重点划重点，这里的eval方法不同于prase方法，外面加括号
            // user = eval("("+user+")");
            return user;
        }


        function getAllBlogs(id) {
            var blogs = null;
            var nothing = {};
            nothing.userId=id;
            $.ajax({
                async: false, //设置同步
                type: 'POST',
                url: 'http://localhost:8080/GRCBlog/getAllBlogs',
                data: nothing,
                dataType: 'json',
                success: function (result) {
                    if (result != null) {
                        blogs = result.blogs;
                    }
                    else {
                        alert('查询错误');
                    }
                },
                error: function (resoult) {
                    alert('查询错误');
                }
            });
            //划重点划重点，这里的eval方法不同于prase方法，外面加括号
            blogs = eval("(" + blogs + ")");
            return blogs;
        }


        function getAllUpload() {
            var uploads = null;
            var nothing = {};
            $.ajax({
                async: false, //设置同步
                type: 'GET',
                url: 'http://localhost:8080/GRCBlog/getAllUpload',
                data: nothing,
                dataType: 'json',
                success: function (result) {
                    if (result != null) {
                        uploads = result.uploads;

                    }
                    else {
                        alert('查询错误');
                    }
                },
                error: function (resoult) {
                    alert('服务器查询错误！');
                }
            });
            //划重点划重点，这里的eval方法不同于prase方法，外面加括号
            uploads = eval("(" + uploads + ")");
            return uploads;

        }

        function formatDate(time) {
            var date = new Date(time);
            Y = date.getFullYear() + '-';
            M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
            D = date.getDate() + ' ';
            h = date.getHours() + ':';
            m = date.getMinutes() + ':';
            s = date.getSeconds();

            return Y + M + D + h + m + s;
        }



</script>
</body>
</html>