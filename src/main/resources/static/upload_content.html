<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <title>资源详情</title>
    <script src="js/src.js"></script>
    <script src="js/util.js"></script>

</head>
<body>

<div class="container" id="upload">

    <div class="col-md-5 col-md-offset-2" id="title">
        <div class="col-md-2 col-md-offset-0">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg">
                <rect width="50" height="60" style="fill:gray;"/>
                <polygon style="fill:#FFFFFF;" points="35,0 50,0 50,15 "/>
                <polygon style="fill:#FFFFFF;" points="30,3 45,20 30,20 "/>
                <text x="5" y="40" font-size="15" style="fill:white">RAR</text>
            </svg>
        </div>

        <div class="col-md-9 col-md-offset-1">
            <h3 id="filename">{{ upload_title }}</h3>
            <div>
                <span class="label label-info label-offset" v-for="tag in tags"> {{ tag.text }}</span>
            </div>
        </div>
    </div>


    <div class="col-md-9 col-md-offset-2">
        <p class="text-muted" >{{ publish_time }}</p>
    </div>

    <div clas="container-content" id="content">
        <div class="col-md-8 col-md-offset-2">
            <h4>资料详细描述：</h4>
            <p id="remark">{{ upload_content }}</p>

            <hr class="divider" width="700px">
        </div>

        <div class="col-md-8 col-md-offset-2">
            <div class="row">
                <div class="col-md-4">
                    <span class="glyphicon glyphicon-yen" aria-hidden="true" style="color: #337ab7" id="score">所需积分：{{ score }}分</span>
                    &nbsp &nbsp;
                </div>
                <div class="col-md-4">
                    <span style="color: #337ab7" id="count">下载次数：{{ downNum }}次</span>
                </div>

                <div class="col-md-4 col-md-offset-8">
                    <button type="button" class="btn btn-default btn-lg"  href="#">
                        <span  class="glyphicon glyphicon-download-alt" aria-hidden="true" style="color: #337ab7">下载</span>
                    </button>
                </div>

                <hr class="divider" width="700px">
            </div>

        </div>
    </div>

</div>

<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script type="text/javascript">

    var upload = new Vue({
        el: "#upload",
        data:{
            upload_title: '标题',

            tags:[
                {text:'标签一'},
                {text:'标签二'}
            ],
            publish_time: ' ranran  2017/6/30 00:00:00',
            upload_content: '空',
            socre:'NULL',
            downNum:'NULL'
        }
    })

    uploadContent();

    function uploadContent() {
        var uploadData = getUpload ();
//        layer.msg(blogData.userId);
        var user = getUser(uploadData.userId);
        var Date = formatDate(uploadData.upTime);
        var tags = getItClassify(uploadData.itClassifyId);

        upload.upload_title = uploadData.name;
        upload.tags = tags.itClassifyname;
        upload.publish_time = user+' '+Date;
        upload.upload_content = uploadData.remark;
        upload.score=uploadData.score;
        upload.downNum=uploadData.downNum;

    }


    function getUpload() {
        var upload = null;
        var uploadfile = {};
        uploadfile.fileId=1;
        $.ajax({
            async : false, //设置同步
            type : 'POST',
            url : 'http://localhost:8080/GRCBlog/getUpload',
            data : uploadfile,
            dataType : 'json',
            success : function(result) {
                if (result!=null) {
                    upload = result.upload;
                }
                else{
                   alert('查询错误');
                }
            },
            error : function(result) {
               alert('查询错误!!');
            }
        });
        //划重点划重点，这里的eval方法不同于prase方法，外面加括号
        upload = eval("("+upload+")");
        return upload;
    }

    function getUser(id) {
        var user = null;
        var users = {};
        users.userId = id;

        $.ajax({
            async : false, //设置同步
            type : 'POST',
            url : 'http://localhost:8080/GRCBlog/getUser',
            data :users,
            dataType : 'json',
            success : function(result) {
                if (result!=null) {
                    user = result.user;
                }
                else{
                    alert('查询错误');
                }
            },
            error : function(result) {
                alert('查询错误!!');
            }
        });
        //划重点划重点，这里的eval方法不同于prase方法，外面加括号
       // user = eval("("+user+")");
        return user.userName;
    }

    function getItClassify(id) {
        var itClassify = null;
        var classify = {};
        classify.itClassifyId = id;

        $.ajax({
            async : false, //设置同步
            type : 'POST',
            url : 'http://localhost:8080/GRCBlog/getItClassify',
            data :classify,
            dataType : 'json',
            success : function(result) {
                if (result!=null) {
                    itClassify = result.itClassify;
                }
                else{
                    alert('查询错误');
                }
            },
            error : function(result) {
                alert('服务器错误!!');
            }
        });
        //划重点划重点，这里的eval方法不同于prase方法，外面加括号
        // user = eval("("+user+")");
        return itClassify;
    }

    function   formatDate(time)   {
        var date = new Date(time);
        Y = date.getFullYear() + '-';
        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
        D = date.getDate() + ' ';
        h = date.getHours() + ':';
        m = date.getMinutes() + ':';
        s = date.getSeconds();

        return Y+M+D+h+m+s;
    }

</script>


</body>
</html>