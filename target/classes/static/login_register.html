<!DOCTYPE html>
<html lang="zh-cn" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>博客首页</title>

    <script src="js/src.js"></script>
    <script src="js/util.js"></script>
</head>
<body>
<script src="js/header.js"></script>
<div class="container">
    <div class="row ">
        <div class="col-sm-4 col-md-4 col-lg-4 col-lg-offset-4 col-sm-offset-4 col-md-offset-4 col-lg-offset-4">
            <div class="row " align="center">
                <a href="index.html"><img src="img/big-brand.png"></a>
            </div>
            <div class="row">
                <div class="panel panel-default">
                    <div class="list-group">
                        <div class="list-group-item">
                            <ul class="nav nav-tabs" role="tablist" id="feature-tab">
                                <li class="active" style="margin-left: 30%"><a href="#tab-login" role="tab" data-toggle="tab">登录</a></li>
                                <li><a href="#tab-register" role="tab" data-toggle="tab">注册</a></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="tab-login">
                                        <div class="form-group">
                                            <div class="input-group">
                                                <div class="input-group-addon">
                                                    <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                                                </div>
                                                <input class="form-control" placeholder="用户名" v-model="userName">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="input-group">
                                                <div class="input-group-addon">
                                                    <span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
                                                </div>
                                                <input type="password" class="form-control" v-model="userPassword" placeholder="密码">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <button type="submit" class="form-control btn btn-primary" v-on:click="login">登录</button>
                                        </div>
                                </div>
                                <div class="tab-pane" id="tab-register">
                                        <div class="form-group">
                                            <div class="input-group">
                                                <div class="input-group-addon">
                                                    <span class="glyphicon glyphicon-user"
                                                          aria-hidden="true"></span>
                                                </div>
                                                <input type="text" v-model="userName" placeholder="用户名"
                                                       class="form-control" data-toggle="tooltip"
                                                       title="请填写用户名" data-trigger="manual"/>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="input-group">
                                                <div class="input-group-addon">
                                                    <span class="glyphicon glyphicon-lock"
                                                          aria-hidden="true"></span>
                                                </div>
                                                <input type="password" v-model="userPassword" value="" placeholder="密码"
                                                       class="form-control"
                                                       data-toggle="tooltip" title="请保证密码以字母开头，长度在6~18之间，只能包含字符、数字和下划线"
                                                       data-trigger="manual"/>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="input-group">
                                                <div class="input-group-addon">
                                                    <span class="glyphicon glyphicon-lock"
                                                          aria-hidden="true"></span>
                                                </div>
                                                <input type="password" v-model="userCheckPassword" placeholder="确认密码"
                                                       class="form-control" data-toggle="tooltip"
                                                       title="请确认密码，两次输入的密码需相同" data-trigger="manual"/>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <button type="submit" class="form-control btn btn-success" v-on:click="register">
                                                注册
                                            </button>
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
//    $(function () {
//        $("[data-toggle='tooltip']").tooltip();
//    });
//    $("input").blur(function () {
//        if ($(this).is("#pwd")) {               //密码判断
//            var ad = /^[a-zA-Z]\w{5,17}$/;
//            if ($("#pwd").val() != "") {
//                if (!(ad.test($("#pwd").val()))) {
//                    $('#pwd').tooltip('show');
//                    return false;
//                } else if (ad) {
//                    $('#pwd').tooltip('hide');
//                    return true;
//                }
//            } else {
//                return true;
//            }
//        }
//        if ($(this).is("#check-pwd")) {            //确认密码判断
//            if ($("#check-pwd").val() != "") {
//                if ($("#pwd").val() != $("#check-pwd").val()) {
//                    $('#check-pwd').tooltip('show');
//                    return false;
//                } else {
//                    $('#check-pwd').tooltip('hide');
//                    return true;
//                }
//            } else {
//                return true;
//            }
//        }
//    })
//
//    $("#register").click(function () {
//        var em = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;   //邮箱正则
//        var pw = /^[a-zA-Z]\w{5,17}$/;     //密码正则
//        if (em.test($("#email").val()) && $("#pwd").val() == $("#check-pwd").val() && pw.test($("#pwd").val())) {
//            return true;
//        } else {
//            if ($("#name").val() == "") {
//                $('#name').tooltip('show');
//            }
//            else if ($("#pwd").val() == "") {
//                $('#pwd').tooltip('show');
//            }
//            else if ($("#check-pwd").val() == "") {
//                $('#check-pwd').tooltip('show');
//            }
//            return false;
//        }
//    })


    var userId = url.getCookie("userId");
    if(userId!= null && userId !="" )
        window.location.href = address+"index.html";

    var cookie = new Vue({
        methods:{
            set: function (name, value, days) {
                var d = new Date;
                d.setTime(d.getTime() + 24*60*60*1000*days);
                window.document.cookie = name + "=" + value + ";path=/;expires=" + d.toGMTString();
            },
            get: function (name) {
                var v = window.document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
                return v ? v[2] : null;
            },
            delete: function (name) {
                this.set(name, '', -1);
            }
        }
    });

    var login = new Vue({
        el:'#tab-login',
        data:{
            userName:'',
            userPassword:''
        },
        methods:{
            login :function () {
                var user = {};
                user.userName = login.userName;
                user.userPassword = login.userPassword;

                var loginResult = '';
                var currentUser = '';
                $.ajax({
                    async : false,
                    type : 'POST',
                    url : 'http://localhost:8080/GRCBlog/doLogin',
                    data : user,
                    dataType : 'json',
                    success : function(result) {
                        loginResult = result.loginResult;
                        if(loginResult == "success")
                            currentUser = result.currentUser;
                    },
                    error : function(result) {
                        alert('服务器异常');
                    }
                });
                if(loginResult == "success") {
                    document.cookie = "userId="+currentUser.userId;
                    layer.msg('登陆成功',{icon:1});
                    window.location.href = "http://localhost:8080/GRCBlog/index.html";
                }
                else if(loginResult == "error")
                    layer.msg("密码错误",{icon:2});
                else if(loginResult == "non-existent")
                    layer.msg("用户不存在",{icon:2});
            }
        }
    });

    var register = new Vue({
        el:'#tab-register',
        data:{
            userName:'',
            userPassword:'',
            userCheckPassword:''
        },
        methods: {
            register: function () {
                var user = {};
                user.userName = register.userName;
                user.userPassword = register.userPassword;
                user.email = '';
                user.sex = '';
                user.phone = '';
                user.address = '';
                user.interest = '';
                user.birthday = '';
                user.remark = '';
                user.job = '';

                var registerResult = '';
                var currentUser = '';
                $.ajax({
                    async: false,
                    type: 'POST',
                    url: 'http://localhost:8080/GRCBlog/doRegister',
                    data: user,
                    dataType: 'json',
                    success: function (result) {
                        registerResult = result.registerResult;
                    },
                    error: function (result) {
                        layer.msg('服务器异常');
                    }
                });
                if (registerResult == "success") {
                    layer.msg('注册成功',{icon:1});
                }
                else
                    layer.msg('注册错误',{icon:2});
            }
        }
    });

</script>

</body>
</html>