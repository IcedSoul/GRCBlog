<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>搜索结果</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

</head>
<body>


<div class="container">
    <div row>
        <div class="col-sm-10 col-md-10 col-lg-10 col-sm-offset-1 col-md-offset-1 col-lg-offset-1">
            <div class="form-inline">
                <input type="text" class="form-control " placeholder="搜索" style="width: 80%">
                <button type="submit" class="btn btn-default no-border">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                </button>
                <a href="http://localhost:8080/GRCBlog/write_question.html"><button class="btn btn-primary ">我要提问</button></a>
            </div>
        </div>
    </div>
    <div row>
        <div class="col-sm-10 col-md-10 col-lg-10 col-sm-offset-1 col-md-offset-1 col-lg-offset-1">
            <div class="panel panel-default">
                <div class="panel-body">
                    <ul class="nav nav-tabs" role="tablist" id="feature-tab">
                        <li class="active">
                            <a href="#tab-article" role="tab" data-toggle="tab">
                                <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> 博文</a>
                        </li>
                        <li ><a href="#tab-resource" role="tab" data-toggle="tab">
                            <span class="glyphicon glyphicon-file" aria-hidden="true"></span> 资源</a></li>
                        <li ><a href="#tab-recent" role="tab" data-toggle="tab">
                            <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span> 问答</a>
                        </li>
                        <li ><a href="#tab-user" role="tab" data-toggle="tab">
                            <span class="glyphicon glyphicon-user" aria-hidden="true"></span> 用户</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab-article">
                            <div class="list-group ">
                                <div class="list-group-item">
                                    <div style="text-align: right">
                                        <button type="button" class="btn btn-default no-border" >按时间排序</button>
                                        <button type="button" class="btn btn-default no-border" >按热门排序</button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group " id="blog">


                            </div>
                        </div>
                        <div class="tab-pane" id="tab-resource">
                            <div class="list-group">
                                <div class="list-group-item">
                                    <div style="text-align: right">
                                        <button type="button" class="btn btn-default no-border">按时间排序</button>
                                        <button type="button" class="btn btn-default no-border">按热门排序</button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group" id="upload">

                            </div>
                        </div>
                        <div class="tab-pane" id="tab-recent">
                            <div class="list-group">
                                <div class="list-group-item">
                                    <div style="text-align: right">
                                        <button type="button" class="btn btn-default no-border">按时间排序</button>
                                        <button type="button" class="btn btn-default no-border">按热门排序</button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group "id="question">

                            </div>
                        </div>
                        <div class="tab-pane" id="tab-user">
                            <div class="list-group default">
                                <div class="list-group-item">
                                    <div class="media">
                                        <div class="media-left media-middle">
                                            <img src="img/display-photo.jpg" class="img-circle img-md">

                                        </div>
                                        <div class="media-body">
                                            <h4 style="font-weight: bold">小民同学</h4>
                                            <p><span class="text-muted">性别：</span>女&nbsp&nbsp&nbsp
                                                <span class="text-muted">职业：</span>java工程师&nbsp&nbsp&nbsp
                                                <span class="text-muted">兴趣：</span>编程&nbsp&nbsp&nbsp</p>
                                            <p><span class="text-muted">个性签名：</span>我爱编程&nbsp&nbsp&nbsp</p>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">


    listBlog();
    function listBlog() {
        var allBlog = getAllBlog();

        var allQuestions = getAllQuestions(1);
        var upload = getAllUpload();

        //博客页
        for (var i = 0; i < allBlog.length; i++) {
            var Data = formatDate(allBlog[i].publishTime);
            var user = getUser(allBlog[i].userId);
            var html = "";
            var imgURL = "http://localhost:8080/GRCBlog/img/" + user.img + ".jpg";
            html += '<div class="list-group-item">' +
                '<div class="pull-right" onclick="BlogDetail(' + allBlog[i].id + ')>' +
                ' <span class="label label-info">java</span>' +
                '<span class="label label-info">计划书</span>' +
                '</div>' +
                '<a class="" href="imgURL"><img src="img/display-photo.jpg"class="img-circle img-md"></a>' +
                '<span>' + user.userName + '小民同学</span>' +
                '<h3>' + allBlog[i].title + '深夜食堂故事集</h3>' +
                '<p>' + allBlog[i].blogContent + '吃东西如果总是快乐的就好了，毕竟这是人们最容易实现的愿望。任何时候，它都不会辜负你。有些食物是不可实现的愿望。这些食物，往往带着非常复杂的往事... </p>' +
                '<span class="text-muted">评论数：</span>' + allBlog[i].LeaveNum + '&nbsp&nbsp&nbsp' +
                '<span class="text-muted">发表时间：</span>' + Data + '&nbsp&nbsp&nbsp ' +
                '</div>' +
                '<hr>';

            var id = "blog";
            var blogArea = document.getElementById(id);
            blogArea.innerHTML += html;
        }

        //资源页
        for (var i = 0; i < upload.length; i++) {
            var Data = formatDate(upload[i].upTime);
            var user = getUser(upload[i].userId);
            var html1 = "";
            html1 += '<div class="list-group-item">' +
                '<div class="pull-right">' +
                ' <span class="label label-info">java</span>' +
                '<span class="label label-info">计划书</span>' +
                '</div>' +
                '<div class="media">' +
                '<div class="media-left">' +
                '<svg width="64" height="64" version="1.1" xmlns="http://www.w3.org/2000/svg">' +
                '<rect width="50" height="60" style="fill:gray;"/>' +
                '<polygon style="fill:#FFFFFF;" points="35,0 50,0 50,15 "/>' +
                '<polygon style="fill:#FFFFFF;" points="30,3 45,20 30,20 "/>' +
                '<text x="5" y="40" font-size="15" style="fill:white">RAR</text>' +
                '</svg>' +
                '</div>' +
                '<div class="media-body">' +
                '<h4 style="">' + upload.name + 'java软件开发计划书</h4>' +
                '<p>' + upload.remark + 'java软件开发计划书java软件开发计划书java软件开发计划书java软件开发计划书 </p>' +
                '<br>' +
                '<span class="text-muted">所需积分：</span>' + upload.score + ' 1&nbsp&nbsp&nbsp' +
                '<span class="text-muted">下载次数：</span>' + upload.downNum + ' 123&nbsp&nbsp&nbsp' +
                'span class="text-muted">上传时间：</span>' + Data + '&nbsp&nbsp&nbsp' +
                '<span class="text-muted">上传者：</span>' + user +
                '</div>' +
                '</div>' +
                '</div>' +
                '<hr>'

            var id = "upload";
            var blogArea = document.getElementById(id);
            blogArea.innerHTML += html1;
        }

        //问答页
        for (var i = 0; i < allQuestions.length; i++) {

            var Data = formatDate(allQuestions[i].publishTime);
            var user = getUser(allQuestions[i].userId);

            var html2 = "";
            html2 += '<div class="list-group-item">' +
                //onClick中的函数需要修改，等端口写好之后，修改，根据id获取问题
                '<div class="pull-right" >' +
                '<span class="label label-info">java</span>  ' +
                '<span class="label label-info">计划书</span>' +
                '</div>' +
                ' <h3 onclick="getAllQuestions(' + allQuestions[i].id + ')">' + allQuestions[i].title + ' </h3>' +
                '<p>' + allQuestions[i].questionContent + ' </p>' +
                ' <span class="text-muted">悬赏积分：</span>' + allQuestions[i].score + ' &nbsp&nbsp&nbsp' +
                ' <span class="text-muted">状态：</span>' + allQuestions[i].state + ' &nbsp&nbsp&nbsp<p>' +
                '<span class="text-muted">回答数：</span>' + allQuestions[i].answerNum + ' &nbsp&nbsp&nbsp' +
                ' <span class="text-muted">发表时间：</span>' + Data + ' &nbsp&nbsp&nbsp' +
                '<span class="text-muted">提问者：</span>' + user + ' &nbsp&nbsp&nbsp' +
                '</div>' +
                '<hr>';

            var id = "question";
            var questionArea = document.getElementById(id);
            questionArea.innerHTML += html2;

        }
    }

        function getAllQuestions(id) {
            var questions = null;
            var nothing = {};
            nothing.userId = id;
            $.ajax({
                async: false, //设置同步
                type: 'POST',
                url: 'http://localhost:8080/GRCBlog/getAllQuestions',
                data: nothing,
                dataType: 'json',
                success: function (result) {
                    if (result != null) {
                        questions = result.questions;
                    }
                    else {
                        layer.alert('查询错误!!');
                    }
                },
                error: function (resoult) {
                    layer.alert('服务器异常');
                }
            });
            //划重点划重点，这里的eval方法不同于prase方法，外面加括号
            questions = eval("(" + questions + ")");
            return questions;
        }


        function getUser(id) {
            var user = null;
            var users = {};
            users.userId = id;

            $.ajax({
                async: false, //设置同步
                type: 'POST',
                url: 'http://localhost:8080/GRCBlog/getUser',
                data: users,
                dataType: 'json',
                success: function (result) {
                    if (result != null) {
                        user = result.user;
                    }
                    else {
                        alert('查询错误');
                    }
                },
                error: function (result) {
                    alert('查询错误!!');
                }
            });
            //划重点划重点，这里的eval方法不同于prase方法，外面加括号
            // user = eval("("+user+")");
            return user.userName;
        }


        function getAllBlog() {
            var allBlog = null;
            var nothing = {};
            $.ajax({
                async: false, //设置同步
                type: 'POST',
                url: 'http://localhost:8080/GRCBlog/getAllBlog',
                data: nothing,
                dataType: 'json',
                success: function (result) {
                    if (result != null) {
                        allBlog = result.allBlog;
                    }
                    else {
                        layer.alert('查询错误');
                    }
                },
                error: function (resoult) {
                    layer.alert('查询错误');
                }
            });
            //划重点划重点，这里的eval方法不同于prase方法，外面加括号
            allBlog = eval("(" + allBlog + ")");
            return allBlog;
        }

        function BlogDetail(id) {
            var Blog = {};
            var blog = '';
            Blog.id = id;
            $.ajax({
                async: false, //设置同步
                type: 'POST',
                url: 'http://localhost:8080/GRCBlog/getBlog',
                data: Blog,
                dataType: 'json',
                success: function (result) {
                    blog = result.blog;
                },
                error: function (resoult) {
                    layer.alert('查询错误');
                }
            });

            if (jumpResult == "success") {
                window.location.href = "http://localhost:8080/GRCBlog/blog_content";
            }
        }

        function getAllUpload() {
            var uploads = null;
            var nothing = {};
            $.ajax({
                async: false, //设置同步
                type: 'POST',
                url: 'http://localhost:8080/GRCBlog/getAllUpload',
                data: nothing,
                dataType: 'json',
                success: function (result) {
                    if (result != null) {
                        uploads = result.uploads;
                    }
                    else {
                        layer.alert('查询错误');
                    }
                },
                error: function (resoult) {
                    layer.alert('查询错误');
                }
            });
            //划重点划重点，这里的eval方法不同于prase方法，外面加括号
            uploads = eval("(" + uploads + ")");
            return uploads;

        }

        function formatDate(time) {
            var date = new Date(time);
            Y = date.getFullYear() + '-';
            M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
            D = date.getDate() + ' ';
            h = date.getHours() + ':';
            m = date.getMinutes() + ':';
            s = date.getSeconds();

            return Y + M + D + h + m + s;
        }



</script>
</body>
</html>